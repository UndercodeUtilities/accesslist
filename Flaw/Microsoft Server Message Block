The way the Microsoft Server Message Block 3.1.1 (SMBv3) protocol addresses such requests has a remote code execution flaw known as the 'Windows SMBv3 ClientServer Remote Code Execution Vulnerability.'

   

import struct

import sys

import socket

sock = socket.socket(socket.AF_INET)

sock.settimeout(4)

sock.connect((sys.argv[1], 445))

packet = b'x00x00x00xc0xfeSMB@x00x00x00x00x00x00x00x00x00x1fx00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00$x00x08x00x01x00x00x00x7fx00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00xx00x00x00x02x00x00x00x02x02x10x02x02$x02x00x03x02x03x10x03x11x03x00x00x00x00x01x00&x00x00x00x00x00x01x00 x00x01x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x00x03x00nx00x00x00x00x00x01x00x00x00x01x00x00x00x01x00x00x00x00x00x00x00'

sock.send(packet)

nb, = struct.unpack(I, sock.recv(4))

result = sock.recv(nb)

if not result[6870] == bx11x03

exit(Not vulnerable)

if not result[7072] == bx02x00

exit(Not vulnerable)

exit(Vulnerable)
