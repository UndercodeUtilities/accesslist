
# For securing and educational purposes only. This script is intended to help system administrators or security professionals disable 7-Zip on a system. It should not be used for malicious purposes or on systems without proper authorization !!!


# Function to display a menu
function Show-Menu {
    Clear-Host
    Write-Host "============================================" -ForegroundColor Cyan
    Write-Host "           7-Zip Disabler Menu" -ForegroundColor Cyan
    Write-Host "============================================" -ForegroundColor Cyan
    Write-Host "[1] Disable 7-Zip" -ForegroundColor Yellow
    Write-Host "[2] Exit" -ForegroundColor Yellow
    Write-Host "============================================" -ForegroundColor Cyan
}

# Function to check for administrator privileges
function Check-Admin {
    if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
        Write-Host "[!] Please run this script as Administrator!" -ForegroundColor Red
        exit
    }
}

# Function to disable 7-Zip
function Disable-SevenZip {
    Write-Host "[+] Fully disabling 7-Zip..." -ForegroundColor Yellow

    # Define 7-Zip install path
    $SevenZipPath = "C:\Program Files\7-Zip"
    $executables = @("7zFM.exe", "7zG.exe", "7z.exe")

    # Disabling executables
    foreach ($exe in $executables) {
        $exePath = "$SevenZipPath\$exe"
        $backupPath = "$SevenZipPath\$exe.disabled"
        if (Test-Path $exePath) {
            Write-Host "[!] Disabling $exe..." -ForegroundColor Red
            Rename-Item -Path $exePath -NewName "$exe.disabled" -Force
        }
    }

    # Blocking execution permissions
    foreach ($exe in $executables) {
        $disabledExePath = "$SevenZipPath\$exe.disabled"
        if (Test-Path $disabledExePath) {
            Write-Host "[!] Blocking execution permissions for $disabledExePath..." -ForegroundColor Red
            icacls $disabledExePath /deny Everyone:RX > $null
        }
    }

    Write-Host "[+] Removing 7-Zip shortcuts from Start Menu..." -ForegroundColor Yellow
    $SevenZipShortcutPath = "$env:ProgramData\Microsoft\Windows\Start Menu\Programs\7-Zip"
    if (Test-Path $SevenZipShortcutPath) {
        Remove-Item -Path "$SevenZipShortcutPath\*" -Force -Recurse -ErrorAction SilentlyContinue
    }

    $UserShortcutPath = "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\7-Zip"
    if (Test-Path $UserShortcutPath) {
        Remove-Item -Path "$UserShortcutPath\*" -Force -Recurse -ErrorAction SilentlyContinue
    }

    Write-Host "[+] Removing 7-Zip from Windows Search Index..." -ForegroundColor Yellow
    reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\7zFM.exe" /f 2>$null
    reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\7zG.exe" /f 2>$null
    reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\7z.exe" /f 2>$null

    Write-Host "7-Zip is now fully disabled. Restart your computer for all changes to apply." -ForegroundColor Green
}

# Main menu loop
while ($true) {
    Show-Menu
    $userChoice = Read-Host "Please select an option"

    switch ($userChoice) {
        '1' {
            Check-Admin
            Disable-SevenZip
            Read-Host "Press Enter to return to the menu"
        }
        '2' {
            Write-Host "Exiting..." -ForegroundColor Green
            exit
        }
        default {
            Write-Host "[!] Invalid option, please try again." -ForegroundColor Red
        }
    }
}

Write-Host "============================================" -ForegroundColor Cyan
Write-Host "            Verified by Undercode" -ForegroundColor Green
Write-Host "============================================" -ForegroundColor Cyan
